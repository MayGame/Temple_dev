<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client</title>
    <script src="agent_client.js"></script>
    <script src="simple_client.js"></script>
</head>
<body>
<script>
var context_1_public_onmessage_access={
    M1650970870378basic_mock_stuff__:`Mock render access`,
    M1651028413933features_to_render:`{["feature1","feature2"]}`,
    M1651098697962trigger_do________:[],

}
var channel_1_public_onmessage_access=async function(k){

return context_1_public_onmessage_access[k]
}
function init(){
let f = document.createElement('div');
f.id="idiv";
f.style.minwidth='100%'
f.style.minheight='100%'
document.body.appendChild(f);
menu_tab("cssr1.html")//fixme
console.log("init");
// render(`Basic HTML`)
}
window.addEventListener("message", pmsg, false);
async function pmsg(event){
        // console.log("processing reply: \n",event.data);
        // data_parse... mock, change to ni. fixme
        let first = event.data.slice(0,32)
        let second = event.data.slice(32,64)
        let rest = event.data.slice(64)
        if(first=="M1650970806134render_context_req")
        {
        let res = await channel_1_public_onmessage_access(rest)//fixme - neuron_activation
        console.log("data",event.data);
        console.log(first,second,rest,res);
        event.source.postMessage('M1650970373796cssr_channel_reply'+second+res,"*")
        }
        else if(first==''){
            //second-messageID to reply

        }
    }
var c2={}
c2.neuron_instances_f={

}
var g2={}
c2._g=g2;

var mockup_proxy_g2_idb_channel=new Proxy(g2,{
    get:function(_,k){
        if(g2[k])
        return g2[k];
        else{
            let res = c.F.WordsRead().get(k)
    res.onsuccess=function(){
        if(res.result)
        g2[k]=res.result
        else console.log('g2 proxy, idb key not found: ',k );
    }//end onsuccess
    return undefined
    }//end else
    },
    set:function(_,k,v){
        g2[k]=v;
        c.F.WordsWrite(k,v);

    },
})
var g3={}
var g3_init_one_to_save_as_word_l1_chunk_immutable_primal_base={


}
var g4_todo={//init_chunk
    M1652686670564c_maps_list_______:['M1652677291018todo______________','M1652689880993subgoals__________'],
    M1652677291018todo______________:[//contains direct text entries (their id)
    'M1652677518316primal_g__________','M1652677570135proxied_g_________','M1652677711692primal_agent______','M1652688522199quests_2layer_idb_',
    ],
    M1652677518316primal_g__________:``,
    M1652677570135proxied_g_________:`Channels, neuron instances, that can be used as g for next level agents`,
    M1652677711692primal_agent______:``,
    M1652688522199quests_2layer_idb_:``,
    //become better
    //defenition -> vars to check -> value to the task ->
    // 'value_of' channel

}
var g5_primal_neurons={
__:['M1652690295524af_text___________'],
M1652690295524af_text___________:[],
M16526910105730J9358541288071129:``,//
M16526910329950J0044392230921002:``,

}
var c5_target_state={//todo - make it like this from global ^
activations_optimized:{},

}
var c5_neurons_primal
function beh_test1(g,c){//put here cases u wanna test
//gets value related to key

//gets id of that entry

//


}
function vc_from_g(g){//direct value maps
    let under_c={};
    let c = new Proxy(under_c,{
        get:function(_,k1){
            return new Proxy(under_c[k1],{
                set:function(_,k2,v2){
                let ks1 = Object.keys(under_c)
                under_c[k1][k2]=v2
                let ks2 = Object.keys(under_c[k1])
                // console.log('g',g)
                // console.log('k1',k1)
                // console.log('k2',k2)
                // console.log('ks1',ks1)
                // console.log('ks2',ks2)
                // console.log()
            g[k1]=ks2;
            g[k2]=v2;
        }
            })
        }
    });
    function init(){
        g.M1652686670564c_maps_list_______.forEach(k=>{
            under_c[k]={};
            console.log('under key',k);
            g[k].forEach(k2=>{
                under_c[k][k2]=g[k2]
            })
        })
    }
    init()
    // return under_c;
    return c;
}
var c4=vc_from_g(g4_todo);
console.log('c4, M1652677570135proxied_g_________',c4.M1652677291018todo______________.M1652677570135proxied_g_________)//direct value
var mockup_proxy_g3_idb_channel=new Proxy(g2,{
    /**
     * quadruples are stored directly in idb words as l0
     * along with primal data (c2 is built on it)
     * l1 chunks can 
     */
    get:function(_,k){
        if(g2[k])
        return g2[k];
        else{
            let res = c.F.WordsRead().get(k)
    res.onsuccess=function(){
        if(res.result)
        g2[k]=res.result
        else console.log('g2 proxy, idb key not found: ',k );
    }//end onsuccess
    return undefined
    }//end else
    },
    set:function(_,k,v){
        g2[k]=v;
        c.F.WordsWrite(k,v);

    },
})
function render(v){//
    //

f = window.frames.renderer;
        // console.log(f);
        f.postMessage(v,'*');//fixme, when origin is known
//
}

//do - do what? - do THAT - for that I need ... (do once you have it all, the context)
//additional context acquisition, before finally triggering delayed action, once it's ready
//react with a question, asking for details. quest, wish. in more complex cases, utility can be added. question creates a task.
//
/*
do: postMessage('action trigger id1')
do what: onmessage("askForAction forID1"), 
*/
//
//alg: goal, details.. 
function force_render_something(a='M1651100196090activation_example'){//sends request to render to specific agent
render('M1651099893264activateFbAsk_____'+a)
//M1651138153434NewActivation_____
// render('M1651030642926render____________M1651030869008something_________')
}
function menu_tab(url){
let f = document.createElement('iframe');
f.src=url;
f.style.minHeight='100%';
f.style.minWidth='100%';
f.style.height='100%';
f.frameBorder='0';
f.name='renderer';
let first = idiv.firstChild;
if(first)
idiv.removeChild(first);
// else
idiv.appendChild(f);
}
window.onload=init;
let lf2p = async ()=>{
    let res = c.F.WordsRead().get('F2P');
    res.onsuccess=function(){
    console.log("F2P: ",res.result);
    // new AsyncFunction(res.result)();
    }}

let checkList_populate=function(){
    /**
     * 1. Add, browse entries
     * 2. Get related info, contents[id], description[id]
     * 3. Keep + transfer data across devices and different sites
     * 4. Subgoals + relations.
     * 5. Classifiers, filters
     * 6. UI: 
     * 7. Agent management, creation, deployment:
     *      context, gctxt, 
     *      agent classification, different types (interface motor, full featured..) 
     * 8. Priorities, weights.
     * 9. Docs
     * 10.
     * 
     */
    // Object.keys(base).forEach(k=>{

    //     // c.F.WordsWrite(e,e)

    // })
    mockup_proxy_g2_idb_channel.tasks;
    setTimeout(()=>{
        if(mockup_proxy_g2_idb_channel.tasks)
    {console.log(mockup_proxy_g2_idb_channel.tasks)}
    else {console.log('no tasks');
    mockup_proxy_g2_idb_channel.tasks=['M1652452272053Add_entries_______','M1652452333691Get_related_info__']
    mockup_proxy_g2_idb_channel.M1652515786067AddEntriesText____='Value. Simple text entry. Add enttries';
    //mockup_proxy_g2_idb_channel
    // mockup_proxy_g2_idb_channel.
    //todo: a(b), description(M1652452272053Add_entries_______) is M1652515786067AddEntriesText____
    /**
     * c.maps.A_value_map[B] returns value of C
     * c.maps.A_id_map[B] returns guid of C
     * 
     * g_entry:
     * c_maps_proxy:
     * 
     */
    // mockup_proxy_g2_idb_channel
}//end else
},100)
}

let add_task = function(task_name,ctxt=c2){
    /**
     * simple version: Proxy context, synced to idb via some channel.
     * list_of_tasks[]
     * 
     * 
     * 
     */
    async function update_task_ids(new_ID){
        mockup_proxy_g2_idb_channel.tasks
        mockup_proxy_g2_idb_channel[new_ID]=''
    }
    update_task_ids()
    c.F.WordsWrite()
}
function browse_tasks_mockup(k=undefined){
    if(k){
        console.log("you browse ",k,"related stuff:")
        // mockup_proxy_g2_idb_channel
        //g2 synced already
        //time to play with c2:
        //maps:
        //[k]
    }
    else
    mockup_proxy_g2_idb_channel.tasks.forEach(t=>{
        console.log('task ',t);

    })
}
</script>
<script src="agent.js"></script>
<script>
// var client_agent={

// }

function text2MJid(text){
    text = text.replaceAll(/\W/ig,"_")
    return ("M"+Date.now()+text+"________________________").slice(0,32);

}
function rid(){return ('M'+Date.now()+Math.random().toString().replace('.','J')+"BB00BB").substr(0,32);}
</script>
</body>
</html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client</title>
    <script src="agent_client.js"></script>
</head>
<body>
<script>
var context_1_public_onmessage_access={
    M1650970870378basic_mock_stuff__:`Mock render access`,
    M1651028413933features_to_render:`{["feature1","feature2"]}`,
    M1651098697962trigger_do________:[],

}
var channel_1_public_onmessage_access=async function(k){

return context_1_public_onmessage_access[k]
}
function init(){
let f = document.createElement('div');
f.id="idiv";
f.style.minwidth='100%'
f.style.minheight='100%'
document.body.appendChild(f);
menu_tab("cssr1.html")//fixme
console.log("init");
// render(`Basic HTML`)
}
window.addEventListener("message", pmsg, false);
async function pmsg(event){
        // console.log("processing reply: \n",event.data);
        // data_parse... mock, change to ni. fixme
        let first = event.data.slice(0,32)
        let second = event.data.slice(32,64)
        let rest = event.data.slice(64)
        if(first=="M1650970806134render_context_req")
        {
        let res = await channel_1_public_onmessage_access(rest)//fixme - neuron_activation
        console.log("data",event.data);
        console.log(first,second,rest,res);
        event.source.postMessage('M1650970373796cssr_channel_reply'+second+res,"*")
        }
    }
function render(v){//
    //

f = window.frames.renderer;
        // console.log(f);
        f.postMessage(v,'*');//fixme, when origin is known
//
}

//do - do what? - do THAT - for that I need ... (do once you have it all, the context)
//additional context acquisition, before finally triggering delayed action, once it's ready
//react with a question, asking for details. quest, wish. in more complex cases, utility can be added. question creates a task.
//
/*
do: postMessage('action trigger id1')
do what: onmessage("askForAction forID1"), 
*/
//
//alg: goal, details.. 
function force_render_something(a='M1651100196090activation_example'){//sends request to render to specific agent
render('M1651099893264activateFbAsk_____'+a)
//M1651138153434NewActivation_____
// render('M1651030642926render____________M1651030869008something_________')
}
function menu_tab(url){
let f = document.createElement('iframe');
f.src=url;
f.style.minHeight='100%';
f.style.minWidth='100%';
f.style.height='100%';
f.frameBorder='0';
f.name='renderer';
let first = idiv.firstChild;
if(first)
idiv.removeChild(first);
// else
idiv.appendChild(f);
}
window.onload=init;
</script>
<script>
var client_agent={

}

function text2MJid(text){
    text = text.replaceAll(/\W/ig,"_")
    return ("M"+Date.now()+text+"________________________").slice(0,32)
}
function rid(){return ('M'+Date.now()+Math.random().toString().replace('.','J')+"BB00BB").substr(0,32);}
</script>
</body>
</html>